{% extends 'base_module.html' %}
{% load static %}

{% block title %}Application {{ application.application_number }} - EMIS{% endblock %}

{% with sidebar_template='includes/sidebars/admissions_sidebar.html' %}

{% block content %}
<div class="container-fluid max-w-6xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-file-alt mr-3"></i>Application Details
            </h2>
            <p class="text-gray-600">Application #{{ application.application_number }}</p>
        </div>
        <div class="flex space-x-3">
            <a href="{% url 'admissions:application_update' application.pk %}" 
               class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                <i class="fas fa-edit mr-2"></i>Edit
            </a>
            {% if user.is_staff %}
            <form method="post" action="{% url 'admissions:application_delete' application.pk %}" 
                  onsubmit="return confirm('Are you sure you want to delete this application?');" class="inline">
                {% csrf_token %}
                <button type="submit" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors">
                    <i class="fas fa-trash mr-2"></i>Delete
                </button>
            </form>
            {% endif %}
        </div>
    </div>

    <!-- Status Badge -->
    <div class="mb-6">
        <span class="px-4 py-2 rounded-full text-sm font-semibold
            {% if application.status == 'approved' %}bg-green-100 text-green-800
            {% elif application.status == 'rejected' %}bg-red-100 text-red-800
            {% elif application.status == 'under_review' %}bg-yellow-100 text-yellow-800
            {% elif application.status == 'submitted' %}bg-blue-100 text-blue-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ application.get_status_display }}
        </span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Personal Information -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fas fa-user mr-2"></i>Personal Information
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-600">First Name</p>
                        <p class="font-semibold text-gray-800">{{ application.first_name }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Last Name</p>
                        <p class="font-semibold text-gray-800">{{ application.last_name }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Email</p>
                        <p class="font-semibold text-gray-800">{{ application.email }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Phone</p>
                        <p class="font-semibold text-gray-800">{{ application.phone }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Date of Birth</p>
                        <p class="font-semibold text-gray-800">{{ application.date_of_birth|date:"F d, Y" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Gender</p>
                        <p class="font-semibold text-gray-800">{{ application.gender }}</p>
                    </div>
                </div>
            </div>

            <!-- Address -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fas fa-map-marker-alt mr-2"></i>Address
                </h3>
                <div class="space-y-2">
                    <p class="text-gray-800">{{ application.address_line1 }}</p>
                    {% if application.address_line2 %}
                    <p class="text-gray-800">{{ application.address_line2 }}</p>
                    {% endif %}
                    <p class="text-gray-800">{{ application.city }}, {{ application.state }} {{ application.postal_code }}</p>
                    <p class="text-gray-800">{{ application.country }}</p>
                </div>
            </div>

            <!-- Academic Background -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fas fa-graduation-cap mr-2"></i>Academic Background
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-600">Previous School</p>
                        <p class="font-semibold text-gray-800">{{ application.previous_school }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Previous Grade</p>
                        <p class="font-semibold text-gray-800">{{ application.previous_grade }}</p>
                    </div>
                    {% if application.gpa %}
                    <div>
                        <p class="text-sm text-gray-600">GPA</p>
                        <p class="font-semibold text-gray-800">{{ application.gpa }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Program Selection -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fas fa-book mr-2"></i>Program Selection
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-600">Program</p>
                        <p class="font-semibold text-gray-800">{{ application.program }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Admission Year</p>
                        <p class="font-semibold text-gray-800">{{ application.admission_year }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Semester</p>
                        <p class="font-semibold text-gray-800">{{ application.admission_semester }}</p>
                    </div>
                </div>
            </div>

            <!-- Review Notes -->
            {% if application.review_notes %}
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">
                    <i class="fas fa-comments mr-2"></i>Review Notes
                </h3>
                <p class="text-gray-800 whitespace-pre-wrap">{{ application.review_notes }}</p>
                {% if application.reviewed_by %}
                <p class="text-sm text-gray-600 mt-4">
                    Reviewed by {{ application.reviewed_by.get_full_name }} on {{ application.reviewed_at|date:"F d, Y" }}
                </p>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Application Info -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-info-circle mr-2"></i>Application Info
                </h3>
                <div class="space-y-3">
                    <div>
                        <p class="text-sm text-gray-600">Application Number</p>
                        <p class="font-semibold text-gray-800">{{ application.application_number }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Submitted At</p>
                        <p class="font-semibold text-gray-800">
                            {% if application.submitted_at %}
                                {{ application.submitted_at|date:"F d, Y H:i" }}
                            {% else %}
                                Not submitted yet
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Status</p>
                        <p class="font-semibold text-gray-800">{{ application.get_status_display }}</p>
                    </div>
                    {% if application.merit_score %}
                    <div>
                        <p class="text-sm text-gray-600">Merit Score</p>
                        <p class="font-semibold text-gray-800">{{ application.merit_score }}</p>
                    </div>
                    {% endif %}
                    {% if application.rank %}
                    <div>
                        <p class="text-sm text-gray-600">Rank</p>
                        <p class="font-semibold text-gray-800">{{ application.rank }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Timestamps -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                    <i class="fas fa-clock mr-2"></i>Timestamps
                </h3>
                <div class="space-y-3">
                    <div>
                        <p class="text-sm text-gray-600">Created</p>
                        <p class="font-semibold text-gray-800">{{ application.created_at|date:"F d, Y H:i" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Last Updated</p>
                        <p class="font-semibold text-gray-800">{{ application.updated_at|date:"F d, Y H:i" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endwith %}
{% endblock %}
