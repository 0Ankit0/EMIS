{% extends 'courses/base_courses.html' %}
{% load static %}

{% block title %}All Courses - EMIS{% endblock %}

{% block content %}
<div class="container-fluid max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex justify-between items-center flex-wrap gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-book mr-2 text-primary-500"></i>All Courses
                </h1>
                <p class="text-gray-600">Manage and view all courses in the system</p>
            </div>
            <a href="{% url 'courses:create' %}" class="btn btn-primary">
                <i class="fas fa-plus-circle mr-2"></i>Add New Course
            </a>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
        <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                <input type="text" name="search" value="{{ search_query }}" 
                       placeholder="Search courses..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                <select name="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">All Status</option>
                    <option value="draft" {% if status_filter == 'draft' %}selected{% endif %}>Draft</option>
                    <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
                    <option value="archived" {% if status_filter == 'archived' %}selected{% endif %}>Archived</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                <select name="department" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">All Departments</option>
                    {% for dept in departments %}
                    <option value="{{ dept }}" {% if department_filter == dept %}selected{% endif %}>{{ dept }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex items-end">
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-search mr-2"></i>Filter
                </button>
            </div>
        </form>
    </div>

    <!-- Courses Table -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="table">
                <thead>
                    <tr>
                        <th class="text-left">Code</th>
                        <th class="text-left">Title</th>
                        <th class="text-left">Department</th>
                        <th class="text-center">Credits</th>
                        <th class="text-center">Status</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses %}
                    <tr>
                        <td class="font-mono font-semibold text-gray-700">{{ course.code }}</td>
                        <td>
                            <div class="font-semibold text-gray-800">{{ course.title }}</div>
                            {% if course.description %}
                            <div class="text-sm text-gray-600 truncate max-w-md">{{ course.description|truncatewords:15 }}</div>
                            {% endif %}
                        </td>
                        <td>
                            <span class="text-gray-700">{{ course.department|default:"â€”" }}</span>
                        </td>
                        <td class="text-center">
                            <span class="inline-flex items-center justify-center w-10 h-10 bg-blue-100 text-blue-700 rounded-full font-semibold">
                                {{ course.credits }}
                            </span>
                        </td>
                        <td class="text-center">
                            <span class="badge {% if course.status == 'active' %}bg-green-100 text-green-700{% elif course.status == 'draft' %}bg-gray-100 text-gray-700{% else %}bg-red-100 text-red-700{% endif %}">
                                {{ course.get_status_display }}
                            </span>
                        </td>
                        <td class="text-center">
                            <div class="flex items-center justify-center gap-2">
                                <a href="{% url 'courses:detail' course.id %}" class="btn btn-sm btn-info" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'courses:update' course.id %}" class="btn btn-sm btn-warning" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'courses:module_list' course.id %}" class="btn btn-sm btn-secondary" title="Modules">
                                    <i class="fas fa-list"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-12">
                            <div class="text-gray-500">
                                <i class="fas fa-inbox text-5xl mb-4"></i>
                                <p class="text-lg">No courses found</p>
                                <p class="text-sm mt-2">Try adjusting your filters or <a href="{% url 'courses:create' %}" class="text-primary-600 hover:text-primary-700">create a new course</a></p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if courses.has_other_pages %}
        <div class="bg-gray-50 px-6 py-4 border-t">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    Showing <span class="font-semibold">{{ courses.start_index }}</span> to 
                    <span class="font-semibold">{{ courses.end_index }}</span> of 
                    <span class="font-semibold">{{ courses.paginator.count }}</span> courses
                </div>
                <div class="flex gap-2">
                    {% if courses.has_previous %}
                    <a href="?page=1{{ request.GET.urlencode }}" class="btn btn-sm btn-outline-secondary">First</a>
                    <a href="?page={{ courses.previous_page_number }}{{ request.GET.urlencode }}" class="btn btn-sm btn-outline-secondary">Previous</a>
                    {% endif %}
                    
                    <span class="px-4 py-2 text-sm text-gray-700">
                        Page {{ courses.number }} of {{ courses.paginator.num_pages }}
                    </span>
                    
                    {% if courses.has_next %}
                    <a href="?page={{ courses.next_page_number }}{{ request.GET.urlencode }}" class="btn btn-sm btn-outline-secondary">Next</a>
                    <a href="?page={{ courses.paginator.num_pages }}{{ request.GET.urlencode }}" class="btn btn-sm btn-outline-secondary">Last</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
